# Инструкция по публикации на GitHub Pages

## Автоматическая публикация через GitHub Actions

Проект настроен для автоматической публикации на GitHub Pages при каждом push в ветку `main`.

### Настройка GitHub Pages

1. Перейдите в настройки репозитория: `Settings` → `Pages`
2. В разделе `Source` выберите:
   - **Source**: `GitHub Actions`
3. Сохраните изменения

### Настройка API URL (обязательно для production)

**⚠️ Важно:** Без настройки API URL фронтенд не сможет работать с бэкендом на GitHub Pages.

#### Вариант 1: Использование GitHub Secrets (рекомендуется)

Если ваш API развернут на отдельном домене:

1. Перейдите в `Settings` → `Secrets and variables` → `Actions`
2. Нажмите `New repository secret`
3. Добавьте:
   - **Name**: `REACT_APP_API_URL`
   - **Value**: `https://your-api-domain.com/api/v1` (замените на реальный URL вашего API)

#### Вариант 2: Локальный бэкенд с прокси

Если бэкенд запущен локально, используйте прокси или туннель (ngrok, Cloudflare Tunnel и т.д.):

1. Создайте туннель к вашему локальному API (например, `https://your-tunnel.ngrok.io`)
2. Добавьте этот URL как секрет `REACT_APP_API_URL` в GitHub

#### Вариант 3: Развертывание бэкенда на том же домене

Если бэкенд развернут на поддомене GitHub Pages или через прокси:
- Настройте `REACT_APP_API_URL` на соответствующий URL
- Убедитесь, что CORS настроен правильно (см. раздел "Настройка CORS")

### Ручная публикация

Если нужно опубликовать вручную:

```bash
cd frontend
npm install
npm run build
```

Затем используйте GitHub CLI или загрузите содержимое папки `frontend/build` в ветку `gh-pages`.

## Важные замечания

1. **Роутинг**: Проект использует `HashRouter` для GitHub Pages, что обеспечивает корректную работу SPA роутинга.

2. **API URL**: 
   - Для локальной разработки API запросы идут на `/api/v1` (относительный путь)
   - Для GitHub Pages **обязательно** настройте секрет `REACT_APP_API_URL` с полным URL вашего API
   - Если `REACT_APP_API_URL` не настроен, приложение покажет предупреждение в консоли и API запросы не будут работать

3. **Настройка CORS на бэкенде**: 
   - Убедитесь, что в `backend/app/core/config.py` в списке `CORS_ORIGINS` есть `https://avtanos.github.io`
   - Или настройте переменную окружения `CORS_ORIGINS` при развертывании бэкенда

3. **Базовая ссылка**: После публикации сайт будет доступен по адресу:
   ```
   https://avtanos.github.io/PTD/
   ```

5. **Обновление**: После каждого push в `main` GitHub Actions автоматически соберет и опубликует новую версию.

## Решение проблем

### Ошибка "CORS Failed" или "NS_ERROR_UNKNOWN_HOST"

Эти ошибки возникают, когда:
1. **API URL не настроен**: Настройте секрет `REACT_APP_API_URL` в GitHub Actions
2. **CORS не настроен на бэкенде**: Добавьте `https://avtanos.github.io` в `CORS_ORIGINS` в настройках бэкенда
3. **API недоступен**: Убедитесь, что ваш API сервер запущен и доступен по указанному URL

### Проверка настройки API URL

После деплоя откройте консоль браузера (F12) на странице GitHub Pages:
- Если видите предупреждение `⚠️ REACT_APP_API_URL не настроен!` - настройте секрет в GitHub
- Если видите ошибку `❌ API URL не настроен` - проверьте значение секрета `REACT_APP_API_URL`

## Локальная проверка сборки

Перед публикацией можно проверить сборку локально:

```bash
cd frontend
npm run build
npm install -g serve
serve -s build
```

Откройте `http://localhost:3000` в браузере для проверки.
