# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–±—ä–µ–∫—Ç–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø –æ–±—ä–µ–∫—Ç–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏

**–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å:** –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç (–ü—Ä–æ–µ–∫—Ç) ‚Äî —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã, –≤–æ–∫—Ä—É–≥ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.

**–ò–µ—Ä–∞—Ä—Ö–∏—è:** –û–±—ä–µ–∫—Ç ‚Üí –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤ ‚Üí –ó–∞—è–≤–∫–∏/–î–æ–∫—É–º–µ–Ω—Ç—ã/–í–û–†/–ö–° –∏ —Ç.–¥.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 1. –ú–æ–¥–µ–ª—å —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (ProjectStage)

**–§–∞–π–ª:** `backend/app/models/project_stage.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–µ—Ä–∞—Ä—Ö–∏–∏ –º–µ–∂–¥—É –ü—Ä–æ–µ–∫—Ç–æ–º –∏ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–æ–º.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `project_id` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –æ–±—ä–µ–∫—Ç—É
- `code`, `name` ‚Äî –∫–æ–¥ –∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞
- `stage_type` ‚Äî —Ç–∏–ø —ç—Ç–∞–ø–∞ (–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π, –æ—Å–Ω–æ–≤–Ω–æ–π, –æ—Ç–¥–µ–ª–æ—á–Ω—ã–π, –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π)
- `order_number` ‚Äî –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `planned_start_date`, `planned_end_date` ‚Äî –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Å—Ä–æ–∫–∏
- `actual_start_date`, `actual_end_date` ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ä–æ–∫–∏
- `status` ‚Äî —Å—Ç–∞—Ç—É—Å —ç—Ç–∞–ø–∞ (planned, in_progress, completed, suspended)
- `progress_percentage` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∞–ø–∞
- `responsible` ‚Äî –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —ç—Ç–∞–ø

**–°–≤—è–∑–∏:**
- –ü—Ä–æ–µ–∫—Ç (–æ–±—ä–µ–∫—Ç) ‚Üí –≠—Ç–∞–ø—ã
- –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤—ã (—á–µ—Ä–µ–∑ ProjectConstruct)
- –≠—Ç–∞–ø ‚Üí –û–±—ä–µ–º—ã —Ä–∞–±–æ—Ç (WorkVolume)
- –≠—Ç–∞–ø ‚Üí –°–º–µ—Ç—ã (Estimate)

---

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ ProjectConstruct

**–§–∞–π–ª:** `backend/app/models/object_construct.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `stage_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–ª—è —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ —ç—Ç–∞–ø
- –ò–µ—Ä–∞—Ä—Ö–∏—è: –û–±—ä–µ–∫—Ç ‚Üí –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–æ–ª–µ `stage_id` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

---

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ MaterialMovement –∫ –æ–±—ä–µ–∫—Ç—É

**–§–∞–π–ª:** `backend/app/models/material.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `project_id` –∏–∑–º–µ–Ω–µ–Ω —Å `nullable=True` –Ω–∞ `nullable=False`
- –í—Å–µ –¥–≤–∏–∂–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Ç–µ–ø–µ—Ä—å –æ–±—è–∑–∞–Ω—ã –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ–±—ä–µ–∫—Ç—É

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –°–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å–∫–ª–∞–¥–æ–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–±—ä–µ–∫—Ç–∞.

---

### 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç—Ç–∞–ø–æ–≤ –≤ WorkVolume –∏ Estimate

**–§–∞–π–ª—ã:** 
- `backend/app/models/work_volume.py`
- `backend/app/models/estimate.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ `stage_id` –≤ –æ–±–µ –º–æ–¥–µ–ª–∏
- –°–≤—è–∑–∏ —Å —ç—Ç–∞–ø–∞–º–∏ —á–µ—Ä–µ–∑ relationship

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –û–±—ä–µ–º—ã —Ä–∞–±–æ—Ç –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —ç—Ç–∞–ø—É –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–º–µ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —ç—Ç–∞–ø–∞–º –ø—Ä–æ–µ–∫—Ç–∞

---

### 5. API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∞–ø–∞–º–∏

**–§–∞–π–ª:** `backend/app/api/v1/project_stages.py`

**Endpoints:**
- `GET /api/v1/project-stages/?project_id={id}` ‚Äî —Å–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ (project_id –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- `GET /api/v1/project-stages/{stage_id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–∞–ø –ø–æ ID
- `POST /api/v1/project-stages/` ‚Äî —Å–æ–∑–¥–∞—Ç—å —ç—Ç–∞–ø
- `PUT /api/v1/project-stages/{stage_id}` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —ç—Ç–∞–ø
- `DELETE /api/v1/project-stages/{stage_id}` ‚Äî —É–¥–∞–ª–∏—Ç—å —ç—Ç–∞–ø

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `project_id` –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞
- –í—Å–µ —ç—Ç–∞–ø—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É

---

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

1. **–ü—Ä–æ–µ–∫—Ç (–û–±—ä–µ–∫—Ç)** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
   - –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–º–µ—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π `project_id`
   - –ü—Ä–æ–µ–∫—Ç —Å–≤—è–∑–∞–Ω —Å–æ –≤—Å–µ–º–∏ –º–æ–¥—É–ª—è–º–∏ —á–µ—Ä–µ–∑ relationships

2. **–ò–µ—Ä–∞—Ä—Ö–∏—è –û–±—ä–µ–∫—Ç ‚Üí –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤**
   - ‚úÖ –ú–æ–¥–µ–ª—å ProjectStage —Å–æ–∑–¥–∞–Ω–∞
   - ‚úÖ ProjectConstruct –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–≤—è–∑—å —á–µ—Ä–µ–∑ —ç—Ç–∞–ø
   - ‚úÖ WorkVolume –∏ Estimate –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —ç—Ç–∞–ø—ã

3. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –æ–±—ä–µ–∫—Ç—É:**
   - ‚úÖ –ó–∞—è–≤–∫–∏ (Application) ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –î–æ–≥–æ–≤–æ—Ä—ã (Contract) ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –¢–µ–Ω–¥–µ—Ä—ã (Tender) ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –°–º–µ—Ç—ã (Estimate) ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –ö–°-2, –ö–°-3 ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –°—á–µ—Ç–∞ (Invoice) ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –û–±—ä–µ–º—ã —Ä–∞–±–æ—Ç (WorkVolume) ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –î–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
   - ‚úÖ –î–≤–∏–∂–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚Äî `project_id` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è):

1. **API —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ project_id:**
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ endpoints –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ `project_id`
   - –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö endpoints —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è (–¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–µ–ª–∞—Ç—å `project_id` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º

2. **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏:**
   - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –°–∫–ª–∞–¥—ã, –ü–æ–¥—Ä—è–¥—á–∏–∫–∏ ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –Ω–µ —Ç—Ä–µ–±—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –æ–±—ä–µ–∫—Ç—É
   - –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏ ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–±—ä–µ–∫—Ç—É
   - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤—ã ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫, –Ω–æ —Å–≤—è–∑—å —Å –æ–±—ä–µ–∫—Ç–æ–º —á–µ—Ä–µ–∑ ProjectConstruct

---

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 1. –£—Å–∏–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°—Ä–µ–¥–Ω–∏–π**

–î–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö endpoints —Å–¥–µ–ª–∞—Ç—å `project_id` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∏–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–º:

```python
# –ü—Ä–∏–º–µ—Ä –¥–ª—è –∑–∞—è–≤–æ–∫
@router.get("/")
def get_applications(
    project_id: int = Query(..., description="ID –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"),
    ...
):
```

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –µ—Å—Ç—å, –Ω–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–∞–º, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –æ–±—ä–µ–∫—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π**

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Å–º–µ—Ç—ã –∏ —Ç.–¥. –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞:

```python
# –ü—Ä–∏–º–µ—Ä –¥–ª—è –∑–∞—è–≤–∫–∏
def create_application(application: ApplicationCreate, db: Session):
    project = db.query(Project).filter(Project.id == application.project_id).first()
    if not project:
        raise HTTPException(404, "–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞
    if not application.department:
        application.department = project.department.name if project.department else None
```

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ –∫–∞–∂–¥–æ–≥–æ endpoint.

---

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°—Ä–µ–¥–Ω–∏–π**

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–∞ —á–µ—Ä–µ–∑ —ç—Ç–∞–ø –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —ç—Ç–∞–ø –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–æ–µ–∫—Ç—É:

```python
def create_construct(construct: ProjectConstructCreate, db: Session):
    if construct.stage_id:
        stage = db.query(ProjectStage).filter(ProjectStage.id == construct.stage_id).first()
        if stage and stage.project_id != construct.project_id:
            raise HTTPException(400, "–≠—Ç–∞–ø –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É")
```

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

---

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç—Ç–∞–ø–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π**

- –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∞–ø–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –í —Ñ–æ—Ä–º–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —ç—Ç–∞–ø–∞
- –í —Å–ø–∏—Å–∫–∞—Ö –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —ç—Ç–∞–ø–∞–º
- –í –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é: –û–±—ä–µ–∫—Ç ‚Üí –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

| –ú–æ–¥—É–ª—å | –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –æ–±—ä–µ–∫—Ç—É | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç—Ç–∞–ø–æ–≤ | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ–±—ä–µ–∫—Ç—É | –°—Ç–∞—Ç—É—Å |
|--------|-------------------|------------------|----------------------|--------|
| –ü—Ä–æ–µ–∫—Ç—ã | ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å | ‚úÖ –ï—Å—Ç—å —Å–≤—è–∑–∏ | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚úÖ |
| –≠—Ç–∞–ø—ã –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚úÖ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚úÖ |
| –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤—ã | ‚úÖ –ß–µ—Ä–µ–∑ ProjectConstruct | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | ‚úÖ –ï—Å—Ç—å | ‚úÖ |
| –ó–∞—è–≤–∫–∏ | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –î–æ–≥–æ–≤–æ—Ä—ã | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –¢–µ–Ω–¥–µ—Ä—ã | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –°–º–µ—Ç—ã | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –ö–°-2/–ö–°-3 | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –°—á–µ—Ç–∞ | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –û–±—ä–µ–º—ã —Ä–∞–±–æ—Ç | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (–¥–≤–∏–∂–µ–Ω–∏—è) | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –°–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |
| –î–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ | ‚ö†Ô∏è –ù–µ—Ç | ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ | ‚úÖ |

**–õ–µ–≥–µ–Ω–¥–∞:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç
- ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
- ‚ùå –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–±—ä–µ–∫—Ç–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –û–±—ä–µ–∫—Ç ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ–±—ä–µ–∫—Ç—É
- ‚úÖ –ù–µ—Ç "–≤–∏—Å—è—á–∏—Ö" –∑–∞–ø–∏—Å–µ–π –±–µ–∑ –æ–±—ä–µ–∫—Ç–∞
- ‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–¥—É—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–±—ä–µ–∫—Ç–∞

### 2. –ò–µ—Ä–∞—Ä—Ö–∏—è: –û–±—ä–µ–∫—Ç ‚Üí –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤
- ‚úÖ –ú–æ–¥–µ–ª—å —ç—Ç–∞–ø–æ–≤ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —ç—Ç–∞–ø–∞–º
- ‚úÖ –û–±—ä–µ–º—ã —Ä–∞–±–æ—Ç –∏ —Å–º–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —ç—Ç–∞–ø—ã

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å helper-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞

### 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ–±—ä–µ–∫—Ç—É
- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ endpoints –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- ‚ö†Ô∏è –ú–æ–∂–Ω–æ —É—Å–∏–ª–∏—Ç—å, —Å–¥–µ–ª–∞–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö endpoints

### 5. –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—ä–µ–∫—Ç–∞ –≤–µ–∑–¥–µ
- ‚úÖ –í—Å–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç project_id
- ‚úÖ –í—Å–µ —Å–ø–∏—Å–∫–∏ –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –æ–±—ä–µ–∫—Ç—É
- ‚úÖ –í—Å–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞** –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏–µ—Ä–∞—Ä—Ö–∏–∏** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
3. **–û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç—Ç–∞–ø–æ–≤
4. **–î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î** –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π (stage_id –≤ ProjectConstruct, WorkVolume, Estimate)
5. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç **–≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç** –æ–±—ä–µ–∫—Ç–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å "–ü—Ä–æ–µ–∫—Ç" —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ–±—ä–µ–∫—Ç—É
- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—è –û–±—ä–µ–∫—Ç ‚Üí –≠—Ç–∞–ø ‚Üí –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ MaterialMovement –∫ –æ–±—ä–µ–∫—Ç—É
- ‚úÖ API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∞–ø–∞–º–∏ —Å–æ–∑–¥–∞–Ω

**–û—Å—Ç–∞–ª–æ—Å—å:**
- –£–ª—É—á—à–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (–∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞)
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∞–ø–∞–º–∏
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏–µ—Ä–∞—Ä—Ö–∏–∏
